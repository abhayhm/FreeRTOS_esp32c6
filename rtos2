// Program to read time in uart and change the blink tome of led

TaskHandle_t task1 = NULL;
TaskHandle_t task2 = NULL;

static int wait = 1000;

void blink_led(void *pvParameters){
    while(1){
        digitalWrite(LED_BUILTIN, HIGH);
        vTaskDelay((TickType_t)(wait / portTICK_PERIOD_MS));

        digitalWrite(LED_BUILTIN, LOW);
        vTaskDelay((TickType_t)(wait / portTICK_PERIOD_MS));
    }
}

void read_input(void *pvParameters){
    while(1){
        if(Serial.available() > 0){
            wait = Serial.parseInt();
            Serial.print("Delay is set to:");
            Serial.println(wait, DEC);
        }
        vTaskDelay(10/portTICK_PERIOD_MS);
    }
}

void setup() {  
    Serial.begin(9600);
    pinMode(LED_BUILTIN, OUTPUT);

    vTaskDelay(1000/portTICK_PERIOD_MS);
    Serial.println("Uart is working");
    
    xTaskCreate(
        blink_led,
        "Blink Led",
        512,
        NULL,
        1,
        &task1
    );

    xTaskCreate(
        read_input,
        "Read Input",
        1024,
        NULL,
        1,
        &task2
    );

    vTaskDelete(NULL);
}

void loop(){

}